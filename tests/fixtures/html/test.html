<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专家级自动化全能性能靶场 (v3.0 专用)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* 模拟医院 HIS 系统常见的超窄滚动表格 */
        .his-table-container {
            height: 400px;
            overflow: auto;
            border: 1px solid #cbd5e1;
        }

        .his-table thead th {
            position: sticky;
            top: 0;
            background: #f8fafc;
            z-index: 10;
            box-shadow: 0 1px 0 #cbd5e1;
        }

        /* 模拟视觉漂移：标题在底部，输入框在顶部，通过 CSS 反转显示 */
        .visual-trap {
            display: flex;
            flex-direction: column-reverse;
        }
    </style>
</head>

<body class="bg-slate-100 p-6">

    <div class="max-w-6xl mx-auto space-y-8">
        <!-- 头部信息 -->
        <header class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
            <h1 class="text-2xl font-bold text-slate-800">Weaver 自动化性能测试靶场 - 专家版</h1>
            <p class="text-slate-500 mt-2">专门用于测试 v3.0 引擎在极端 DOM 结构、异步加载、视觉匹配上的性能表现。</p>
        </header>

        <!-- 场景 1：模拟政务/医院系统慢速加载 (测试稳定性算法) -->
        <section class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 relative min-h-[300px]"
            id="async-section">
            <div id="loader" class="loading-overlay">
                <div class="spinner"></div>
                <p class="mt-4 text-blue-600 font-bold">系统正在载入数据 (模拟 3 秒延迟)...</p>
            </div>
            <div id="async-content" class="hidden">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <span class="w-2 h-6 bg-blue-500 mr-2"></span> 场景 1：异步渲染与稳定性检测
                </h2>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700">审批流水号 (异步加载)</label>
                        <input type="text" class="mt-1 block w-full border border-slate-300 rounded-md p-2"
                            placeholder="请输入...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700">业务类别</label>
                        <select class="mt-1 block w-full border border-slate-300 rounded-md p-2">
                            <option>医疗保险</option>
                            <option>养老保险</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <!-- 场景 2：HIS 手术耗材批量录入表格 (测试 Table Header 与 Row Index) -->
        <section class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
            <h2 class="text-lg font-bold mb-4 flex items-center">
                <span class="w-2 h-6 bg-emerald-500 mr-2"></span> 场景 2：HIS 高密集批量录入 (无 Label 模式)
            </h2>
            <div class="his-table-container">
                <table class="his-table w-full text-xs text-left border-collapse">
                    <thead>
                        <tr class="bg-slate-50 text-slate-600">
                            <th class="p-2 border border-slate-200 w-10">#</th>
                            <th class="p-2 border border-slate-200 min-w-[120px]">耗材条码 (Barcode)</th>
                            <th class="p-2 border border-slate-200 min-w-[150px]">名称规格</th>
                            <th class="p-2 border border-slate-200 w-24">生产批号</th>
                            <th class="p-2 border border-slate-200 w-20">消耗数量</th>
                            <th class="p-2 border border-slate-200 w-24">有效期</th>
                        </tr>
                    </thead>
                    <tbody id="table-rows">
                        <!-- 由 JS 生成 20 行，测试性能 -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- 场景 3：Shadow DOM 嵌套与视觉匹配陷阱 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Shadow DOM -->
            <section class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <span class="w-2 h-6 bg-purple-500 mr-2"></span> 场景 3：Shadow DOM 穿透
                </h2>
                <div id="shadow-host" class="p-4 bg-slate-50 border border-dashed border-slate-300 rounded-lg">
                    <!-- Shadow DOM 内容将在此注入 -->
                </div>
            </section>

            <!-- 视觉匹配陷阱 -->
            <section class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                <h2 class="text-lg font-bold mb-4 flex items-center">
                    <span class="w-2 h-6 bg-orange-500 mr-2"></span> 场景 4：视觉坐标匹配陷阱
                </h2>
                <div class="space-y-6">
                    <!-- 陷阱：标题在 HTML 下方，但视觉上在左侧 -->
                    <div class="flex items-center space-x-2">
                        <input type="text" class="w-48 border border-slate-300 p-2 rounded" placeholder="完全没有Label属性">
                        <span class="text-sm text-slate-600 font-bold">患者紧急联系人</span>
                    </div>

                    <!-- 陷阱：垂直对齐标题 -->
                    <div class="text-center w-48">
                        <div class="text-xs text-slate-500">主刀医生签名</div>
                        <input type="text" class="w-full border-b border-slate-900 focus:outline-none text-center"
                            value="张三">
                    </div>
                </div>
            </section>
        </div>

        <footer class="text-center text-slate-400 text-sm pb-10">
            自动化性能靶场 v3.0 | 仅用于 SmartFormAnalyzer 压力测试
        </footer>
    </div>

    <script>
        // --- 逻辑 1: 模拟异步加载 ---
        setTimeout(() => {
            document.getElementById('loader').classList.add('hidden');
            document.getElementById('async-content').classList.remove('hidden');
        }, 3000);

        // --- 逻辑 2: 生成 20 行 HIS 表格数据 ---
        const tbody = document.getElementById('table-rows');
        for (let i = 1; i <= 20; i++) {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td class="p-2 border border-slate-200 text-center text-slate-400">${i}</td>
                <td class="p-2 border border-slate-200"><input type="text" class="w-full border-none focus:ring-0 text-[11px]" placeholder="Scan..."></td>
                <td class="p-2 border border-slate-200 text-slate-600">一次性无菌手术包(规格 ${i})</td>
                <td class="p-2 border border-slate-200"><input type="text" class="w-full border-none focus:ring-0 text-[11px]"></td>
                <td class="p-2 border border-slate-200"><input type="number" class="w-full border-none focus:ring-0 text-[11px]" value="1"></td>
                <td class="p-2 border border-slate-200"><input type="date" class="w-full border-none focus:ring-0 text-[11px]"></td>
            `;
            tbody.appendChild(tr);
        }

        // --- 逻辑 3: 注入 Shadow DOM ---
        const shadowHost = document.getElementById('shadow-host');
        const shadowRoot = shadowHost.attachShadow({ mode: 'open' });
        shadowRoot.innerHTML = `
            <style>
                .shadow-input { border: 1px solid #ccc; padding: 5px; width: 100%; box-sizing: border-box; }
                .label { font-size: 12px; color: #666; margin-bottom: 4px; display: block; }
            </style>
            <div style="padding: 10px; background: #fff; border-radius: 4px;">
                <span class="label">内部封闭系统ID (Shadow Root)</span>
                <input type="text" class="shadow-input" placeholder="Weaver 应该能看到我">
            </div>
        `;
    </script>
</body>

</html>